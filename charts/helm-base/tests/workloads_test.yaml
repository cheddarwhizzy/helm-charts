# yaml-language-server: $schema=https://raw.githubusercontent.com/helm-unittest/helm-unittest/main/schema/helm-testsuite.json
suite: workload types test
templates:
  - deployment.yaml
  - statefulset.yaml
  - job.yaml
  - cronjob.yaml
  - daemonset.yaml
tests:
  - it: should render StatefulSet when kind is StatefulSet
    set:
      kind: StatefulSet
      containers:
        - name: app
          image: nginx:latest
    template: statefulset.yaml
    asserts:
      - hasDocuments:
          count: 1
      - isKind:
          of: StatefulSet
      - equal:
          path: metadata.name
          value: RELEASE-NAME-helm-base

  - it: should render Job when kind is Job
    set:
      kind: Job
      containers:
        - name: app
          image: nginx:latest
    template: job.yaml
    asserts:
      - hasDocuments:
          count: 1
      - isKind:
          of: Job
      - equal:
          path: metadata.name
          value: RELEASE-NAME-helm-base

  - it: should render CronJob when kind is CronJob
    set:
      kind: CronJob
      schedule: "0 0 * * *"
      containers:
        - name: app
          image: nginx:latest
    template: cronjob.yaml
    asserts:
      - hasDocuments:
          count: 1
      - isKind:
          of: CronJob
      - equal:
          path: metadata.name
          value: RELEASE-NAME-helm-base
      - equal:
          path: spec.schedule
          value: "0 0 * * *"

  - it: should render DaemonSet when kind is DaemonSet
    set:
      kind: DaemonSet
      containers:
        - name: app
          image: nginx:latest
    template: daemonset.yaml
    asserts:
      - hasDocuments:
          count: 1
      - isKind:
          of: DaemonSet
      - equal:
          path: metadata.name
          value: RELEASE-NAME-helm-base

  - it: should render Deployment by default
    set:
      containers:
        - name: app
          image: nginx:latest
    template: deployment.yaml
    asserts:
      - hasDocuments:
          count: 1
      - isKind:
          of: Deployment
      - equal:
          path: metadata.name
          value: RELEASE-NAME-helm-base
